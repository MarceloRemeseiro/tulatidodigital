---
import content from '../content/testimonials.json';
import type { Testimonial } from '../content/types';
const testimonials = content.testimonials as Testimonial[];
---

<section id="casos-exito" class="py-20 md:py-32 bg-background-main relative overflow-hidden">
    <!-- Comillas decorativas de fondo -->
    <div class="absolute -top-10 left-4 md:left-10 text-[15rem] lg:text-[20rem] font-serif text-foreground/5 z-0" aria-hidden="true">“</div>
    <div class="absolute -bottom-20 right-4 md:right-10 text-[15rem] lg:text-[20rem] font-serif text-foreground/5 z-0" aria-hidden="true">”</div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
        <div class="text-center">
            <h2 class="text-3xl md:text-4xl font-extrabold text-foreground">{content.title}</h2>
            <p class="mt-4 max-w-2xl mx-auto text-lg text-foreground/80">{content.subtitle}</p>
        </div>
        
        <div class="mt-16 overflow-hidden relative max-w-4xl mx-auto">
            <div id="testimonial-carousel" class="flex transition-transform duration-500 ease-in-out">
                <!-- El carrusel se renderiza con JS para evitar duplicidad de código -->
            </div>
        </div>
        
        <div class="text-center mt-8 flex justify-center space-x-3" id="carousel-dots">
            <!-- Los dots se generarán dinámicamente -->
        </div>
    </div>
</section>

<script is:inline define:vars={{ testimonials }}>
  document.addEventListener('DOMContentLoaded', function () {
    const carouselContainer = document.getElementById('testimonial-carousel');
    const dotsContainer = document.getElementById('carousel-dots');
    
    if (!carouselContainer || !dotsContainer) return;

    let currentTestimonial = 0;
    let carouselInterval;

    function renderCarousel() {
      carouselContainer.innerHTML = '';
      dotsContainer.innerHTML = '';
      
      testimonials.forEach((t, index) => {
        const slide = document.createElement('div');
        slide.className = 'w-full flex-shrink-0 px-4';
        // HTML de la tarjeta de testimonio unificado
        slide.innerHTML = `
          <div class="bg-gradient-to-br from-card to-background-alt text-card-foreground p-8 rounded-2xl shadow-lg border border-border h-full flex flex-col justify-center">
            <p class="text-xl italic">"${t.quote}"</p>
            <p class="mt-8 text-lg font-bold text-primary">${t.name}</p>
            <p class="text-sm text-muted-foreground">${t.role}</p>
          </div>
        `;
        carouselContainer.appendChild(slide);

        const dot = document.createElement('button');
        dot.className = `w-3 h-3 rounded-full transition ${index === currentTestimonial ? 'bg-primary' : 'bg-foreground/20'}`;
        dot.addEventListener('click', () => {
          currentTestimonial = index;
          updateCarousel();
          resetInterval();
        });
        dotsContainer.appendChild(dot);
      });
      updateCarousel();
    }
    
    function updateCarousel() {
      carouselContainer.style.transform = `translateX(-${currentTestimonial * 100}%)`;
      Array.from(dotsContainer.children).forEach((dot, index) => {
        dot.className = `w-3 h-3 rounded-full transition ${index === currentTestimonial ? 'bg-primary' : 'bg-foreground/20'}`;
      });
    }

    function nextTestimonial() {
      currentTestimonial = (currentTestimonial + 1) % testimonials.length;
      updateCarousel();
    }

    function resetInterval() {
      clearInterval(carouselInterval);
      carouselInterval = setInterval(nextTestimonial, 6000);
    }

    renderCarousel();
    resetInterval();

    carouselContainer.addEventListener('mouseenter', () => clearInterval(carouselInterval));
    carouselContainer.addEventListener('mouseleave', () => resetInterval());
  });
</script> 